<%- include('../partials/header') %>
<form action="" method="post" id="all" enctype="multipart/form-data">

  <%- include('../partials/navbar') %>
  <br />
  <h1>Edit Issue</h1>

  <div class="d-flex">
    <div style="margin-left: -10px;" class="p-2">Tracker</div>
    <div style="margin-left: 140px;" class="p-2">
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="tracker"
      id="exampleRadios1"
      value="Bug"<%= issue.tracker == 'Bug' ? ' checked' : '' %>
      
      
    />
    <label class="form-check-label" for="exampleRadios1"> Bug </label>
  </div>
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="tracker"
      id="exampleRadios2"
      value="Feature"<%= issue.tracker == 'Feature' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios2">
      Feature
    </label>
  </div>
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="tracker"
      id="exampleRadios3"
      value="Support" <%= issue.tracker == 'Support' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios3">
      Support
    </label>
  </div>
</div>
</div>

<br>

<div class="mb-3 row">
    <label for="Name" class="col-sm-2 col-form-label">Subject</label>
    <div class="col-sm-10">
      <input required
        type="text"
        value="<%= issue.subject %>"
        class="form-control"
        id="Name"
        name="subject"
        placeholder="Name"
        
      />
    </div>
  </div>

  <br>

  <div class="mb-3 row">
    <label for="Name" class="col-sm-2 col-form-label">Description</label>
    <div class="col-sm-10">
      <textarea required
        type="text"
        
        class="form-control"
        id="Name"
        name="description"
        placeholder="Name"
        
      ><%= issue.description %></textarea>
    </div>
  </div>

 

  <div class="d-flex">
    <div style="margin-left: -5px;" class="p-2">Status</div>
    <div style="margin-left: 140px;" class="p-2">
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="status"
      id="exampleRadios1"
      value="New"<%= issue.status == 'New' ? ' checked' : '' %>
      
      
    />
    <label class="form-check-label" for="exampleRadios1"> New </label>
  </div>
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="status"
      id="exampleRadios2"
      value="In Progress"<%= issue.status == 'In Progress' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios2">
        In Progress
    </label>
  </div>
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="status"
      id="exampleRadios3"
      value="Resolved" <%= issue.status == 'Resolved' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios3">
      Resolved
    </label>
  </div>

  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="status"
      id="exampleRadios4"
      value="Feedback" <%= issue.status == 'Feedback' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios4">
      Feedback
    </label>
  </div>

  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="status"
      id="exampleRadios5"
      value="Closed" <%= issue.status == 'Closed' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios5">
      Closed
    </label>
  </div>
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="status"
      id="exampleRadios6"
      value="Rejected" <%= issue.status == 'Rejected' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios6">
      Rejected
    </label>
  </div>
</div>
</div>


<div class="d-flex">
    <div style="margin-left: -10px;" class="p-2">Priority</div>
    <div style="margin-left: 140px;" class="p-2">
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="priority"
      id="exampleRadios1"
      value="Normal"<%= issue.priority == 'Normal' ? ' checked' : '' %>
      
      
    />
    <label class="form-check-label" for="exampleRadios1"> Normal </label>
  </div>
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="priority"
      id="exampleRadios2"
      value="High"<%= issue.priority == 'High' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios2">
      High
    </label>
  </div>
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="priority"
      id="exampleRadios3"
      value="Urgent" <%= issue.priority == 'Urgent' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios3">
      Urgent
    </label>
  </div>
  <div class="col">
    <input required
      class="form-check-input"
      type="radio"
      name="priority"
      id="exampleRadios4"
      value="Immediate" <%= issue.priority == 'Immediate' ? ' checked' : '' %>
    />
    <label class="form-check-label" for="exampleRadios4">
      Immediate
    </label>
  </div>
</div>
</div>
<br>
  <div class="mb-3 row">
    <label for="assignee" class="col-sm-2 col-form-label">Assignee</label>
    <div class="col-sm-10">
      <select required
        class="form-select"
        aria-label="Default select example"
        id="assignee"
        name="assignee"
      >
        <option selected>Open this select menu</option>
        <% ambiluser.forEach((item, index) => { %>
            <option value="<%= item.userid %>" <%= item.userid == issue.assignee ? ' selected' : ''   %>><%= item.firstname %></option>
            <% }) %>
        
      </select>
    </div>
  </div>

  
  <br />

  <div class="mb-3 row">
    <label class="col-sm-2 col-form-label">Start Date</label>
    <div class="col-sm-10">
      <input required
        type="date"
        value="<%= moment(issue.startdate).format('YYYY-MM-DD') %>"
        class="form-control"
        id="start"
        name="startdate"
      />
      <br /> 
    </div>
  </div>

  <div class="mb-3 row">
    <label class="col-sm-2 col-form-label">Due Date</label>
    <div class="col-sm-10">
      <input required
        type="date"
        value="<%= moment(issue.duedate).format('YYYY-MM-DD') %>"
        class="form-control"
        id="due"
        name="duedate"
      />
      <br /> 
    </div>
  </div>

  <div class="mb-3 row">
    <label for="Estimated" class="col-sm-2 col-form-label">Estimated Time</label>
    <div class="col-sm-10">
      <input required
      value="<%= issue.estimatedtime %>"
        type="number"
        class="form-control"
        id="Estimated"
        name="estimatedtime"
        placeholder=""
        
      />
    </div>
  </div>

  <div class="mb-3 row">
    <label for="Done" class="col-sm-2 col-form-label">% Done</label>
    <div class="col-sm-10">
      <input required
      value="<%= issue.done %>"
        type="number"
        class="form-control"
        id="Done"
        name="done"
        placeholder=""
        
      />
    </div>
  </div>

  <div class="mb-3 row">
    <label for="Files" class="col-sm-2 col-form-label">Files</label>
    
    <div class="col-sm-5">
      <div class="row">
        <% if(issue.files && issue.files.length >0) { %>
          <% issue.files.forEach(files => { %>
            <% if  (files.mimetype== 'image/png') {%>
            <div class="col-sm-3" >
              <input type="hidden" name="files" value=" <%= JSON.stringify(files) %>">
              <a   href="<%= `${baseUrl}/images/${files.name}` %>" target="blank"><img  src="<%= `${baseUrl}/images/${files.name}` %>" width="50"></a> 
              <button type="button" id="btn-minus" class="btn btn-primary btn-edit" > <i class="fas fa-minus"  aria-hidden="true"></i></button>
            </div>
            <%  }%>
            <% if  (files.mimetype != 'image/png') {%>
              <div class="col-sm-3" >
                <input type="hidden" name="files" value=" <%= JSON.stringify(files) %>">
                <a   href="<%= `${baseUrl}/images/${files.name}` %>" target="blank"><%= `${baseUrl}/images/${files.name}` %></a> 
                <button type="button" id="btn-minus" class="btn btn-primary btn-edit" > <i class="fas fa-minus"  aria-hidden="true"></i></button>
              </div>
              <%  }%>
       <% })} %>
      </div>
      
      <input 
        type="file"
       
        class="form-control"
        id="Files"
        name="files"
      
        
        />
       
        
        
      </div>
    </div>

    

    <div class="mb-3 row" id="btn-add2">
      <label for="Files" class="col-sm-2"></label>
      
     
        <div class="col-sm-5">
          <button type="button" id="btn-add" class="btn btn-primary" > <i class="fas fa-plus" aria-hidden="true"></i></button>
        </div>
          
        </div>
    
    <br />

    
  <button type="submit" class="btn btn-primary">Save</button>

  <a class="btn btn-warning" href="/projects/issue/<%= projectid %>">Back</a>
</form>

<script>

  var input = ` <div class="mb-3 row">
    <label for="Files" class="col-sm-2 col-form-label"></label>
    <div class="col-sm-5">
      
      <input
      type="file"
      
      class="form-control"
      id="Files"
      name="files"
      
      
      />
      
      </div>
      <div class="col-sm-5">
      <button type="button" id="btn-minus" class="btn btn-primary btn-delete" > <i class="fas fa-minus" aria-hidden="true"></i></button>
    </div>
      </div>`
  
  $("#btn-add").click(function(){
  $("#btn-add2").before(input);
});

$(document).ready(function(){
  $( "#all" ).on( "click", ".btn-delete", function() {
 $( this ).closest(".mb-3").remove()
});
});

$(document).ready(function(){
  $( "#all" ).on( "click", ".btn-edit", function() {
 $( this ).closest(".col-sm-3").remove()
});
});
</script>

<%- include('../partials/footer') %>
